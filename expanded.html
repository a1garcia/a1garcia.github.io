<html>
<head>
  <style>
  form {
    display: inline;
  }
  </style>
  <script>
  function error (errorMessage, action) {
    document.getElementById("error").innerText = errorMessage +":"+ action;
  };

  function update() {
    document.getElementById("version").innerText = mraid.getVersion();
    document.getElementById("placementType").innerText = mraid.getPlacementType();
    document.getElementById("state").innerText = mraid.getState();

    if (window.DeviceOrientationEvent) {
      document.getElementById("orientation").innerText = 'true';
    }
    else {
      document.getElementById("orientation").innerText = 'false';
    }

    if (window.DeviceMotionEvent) {
      document.getElementById("motion").innerText = 'true';
    }
    else {
      document.getElementById("motion").innerText = 'false';
    }

    if (window.GeoLocation) {
      document.getElementById("location").innerText = 'true';
    }
    else {
      document.getElementById("location").innerText = 'false';
    }
  }

  function ready() {
    document.getElementById("ready").innerText = 'ready';
    logEvent("ready");
    update();
  };

  function stateChanged(state) {
    document.getElementById("state").innerText = state;
    logEvent("stateChanged");
  };

  function viewableChanged(viewable) {
    document.getElementById("viewable").innerText = viewable;
    logEvent("viewableChanged");
  };

  function logEvent(eventName) {
    document.getElementById("event").innerText = eventName;
  };

  function clearValue(field) {
    document.getElementById(field).innerText = '';
  };

  function getProps() {
    var props = mraid.getExpandProperties();
    var txt = "";
    if (props) {
      txt="["
      for (prop in props) {
        txt += prop +":"+ props[prop] + ", "
      }
      txt+="]";
    }
    else {
      txt = "none";
    }

    document.getElementById("expandProps").innerText = txt ;
  };

  function setProps() {
    props = {
      "width" : 300,
      "height" : 250,
      "useCustomClose" : false,
      "isModal" : true
    };
    mraid.setExpandProperties(props);
  };

  var cookieName = "adLibTest";
  function setCookie(value,days) {
    if (days) {
      var date = new Date();
      date.setTime(date.getTime()+(days*24*60*60*1000));
      var expires = "; expires="+date.toGMTString();
    }
    else var expires = "";
    document.cookie = cookieName+"="+value+expires+"; path=/";
    document.getElementById("cookieValue").innerText = "set";
  }

  function getCookie() {
    var nameEQ = cookieName + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
      var c = ca[i];
      while (c.charAt(0)==' ') c = c.substring(1,c.length);
      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
  }

  function showCookie() {
    document.getElementById("cookieValue").innerText = getCookie();
  }

  function deleteCookie() {
    setCookie("", -1);
    document.getElementById("cookieValue").innerText = "deleted";
  }

  var localName = "adLibTest";
  function setLocal() {
    localStorage.setItem(localName,'1');
    document.getElementById("localValue").innerText = "set";
  }

  function getLocal() {
    return localStorage.getItem(localName);
  }

  function showLocal() {
    document.getElementById("localValue").innerText = getLocal();
  }

  function deleteLocal() {
    localStorage.removeItem(localName);
    document.getElementById("localValue").innerText = "deleted" ;
  }

  function initMRAID() {
    mraid.addEventListener("error", error);
    mraid.addEventListener("ready", ready);
    mraid.addEventListener("stateChange", stateChanged);
    mraid.addEventListener("viewableChange", viewableChanged);

        document.getElementById("xhrButton").addEventListener("click", function (event) {
          var xhr = new XMLHttpRequest();
          xhr.addEventListener("load", function (event) {
            console.log(event);
          });
          xhr.open("GET", "https://i.forbesimg.com/forbes/scripts/af45f03d.vendor.js");
          xhr.send();
        });
  }

  window.addEventListener("DOMContentLoaded", initMRAID(), false);

  </script>
</head>

<body bgcolor="Bisque">
    <h1>Expanded View</h1>
  MRAID <b>V<span id="version">?</span></b> API Test <a href="javascript:update()">update</a>
    <b>Ready:</b> <span id="ready">?</span>
  <br/>
  <b>Placement Type:</b> <span id="placementType">?</span>
  <b>State:</b> <span id="state">?</span>
  <b>Viewable:</b> <span id="viewable"></span>
  <br/>
  <b>Orientation:</b> <span id="orientation">?</span>
  <b>Motion:</b> <span id="motion">?</span>
  <b>Location:</b> <span id="location">?</span>
  <br/>
  <b>Link:</b>
  <a href="iadoptout://">iadoptout href</a>
  <br/>
  <b>Open:</b>
  <a href="javascript:mraid.open('iadoptout://');">iadoptout</a>
  <a href="javascript:mraid.open('https://apple.news/TJDWkW4ViMXKFpHEiFEp8Zw');">feed deeplink</a>
  <a href="javascript:mraid.open('https://apple.news/ASysmZg04TGCFzoes9iXqgg');">article deeplink</a>
  <br/>
  <b>Expand:</b>
  <a href="javascript:mraid.expand('https://iad2v2-iadctest.iad.apple.com/adunits/ERIE/mraid-expanded.html');">mraid api</a>
  <br/>
  <b>Expand Props:</b>
  <a href="javascript:getProps();">get</a> <a href="javascript:setProps();">set</a>
  (<a href="javascript:clearValue('expandProps');">clear</a>)<span id="expandProps"></span>
  <br/>
  <b>Close:</b>
  <a href="javascript:mraid.close();">close</a>
  useCustom: <a href="javascript:mraid.useCustomClose(true);">true</a>
  <a href="javascript:mraid.useCustomClose(false);">false</a>
  <br/>
  <b>Cookie:</b> <a href="javascript:setCookie('1', 1);">set</a> <a href="javascript:showCookie();">get</a>
  <a href="javascript:deleteCookie('1', 1);">delete</a> cookie: <span id="cookieValue"></span>
  <br/>
  <b>Local:</b> <a href="javascript:setLocal('1');">set</a> <a href="javascript:showLocal();">get</a>
  <a href="javascript:deleteLocal();">delete</a> local: <span id="localValue"></span>
  <br/>
  <b>Unsupported:</b> <a href="tel:1-800-123-4567">Call a number</a> <a href="sms:123456">Send a SMS</a>
  <br/>
  <b>Error:</b> <span style="color:red" id="error"></span> (<a href="javascript:clearValue('error');">clear</a>)
  <br/><br/>
  <b>eventListener</b>("viewableChange") :
  <a href="javascript:mraid.addEventListener('viewableChange', viewableChanged);">add</a>
  <a href="javascript:mraid.removeEventListener('viewableChange', viewableChanged);">remove</a>
  <br/>
  <b>Event:</b> <span id="event"></span> (<a href="javascript:clearValue('event');">clear</a>)
  <br/>
  <b>Form:</b>
  <form action="http://httpbin.org/post" method="post"><input size="2" type="text" name="val">
  <button type="submit">Submit http</button>
  </form>
  <form action="https://httpbin.org/post" method="post"><input size="2" type="text" name="val">
  <button type="submit">Submit https</button>
  </form>
  <br/>
        <button id="xhrButton" type="button">Make XHR request</button>
        <br/>
        <iframe width="768" height="50"
src="https://iad2v2-iadctest.iad.apple.com/adunits/ERIE/iframe-content.html"
  frameborder="0" allowfullscreen></iframe>
</body>
</html>

